<!DOCTYPE html>
<html lang="en">
<head> 
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teachable Machine</title>

<!-- SEO Meta Tags -->
<meta name="description" content="Teachable Machine UI - capture and manage image samples for machine learning projects.">
<meta name="keywords" content="Teachable Machine, Machine Learning, Image Capture, Image Samples, Webcam, Upload Images">
<meta name="author" content="Your Name">
<meta name="robots" content="index, follow">

<!-- Open Graph / Social Sharing -->
<meta property="og:title" content="Teachable Machine - Capture & Manage Image Samples">
<meta property="og:description" content="Use this interface to capture and manage image samples for ML projects using webcam or upload.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://yourwebsite.com">
<meta property="og:image" content="https://yourwebsite.com/preview.png">

<!-- Favicon -->
<link rel="icon" href="favicon.ico" type="image/x-icon">

<style>
/* ---------- Base Styles ---------- */
body {
  margin: 0;
  padding: 0;
  background: black;
  color: white;
  font-family: "Segoe UI", sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  margin: 40px 0 20px;
  font-size: 36px;
  font-weight: 500;
}

.class-container {
  display: flex;
  gap: 20px;
  margin-top: 30px;
  flex-wrap: wrap;
  justify-content: center;
}

.class-box {
  background: white;
  color: black;
  border-radius: 12px;
  width: 500px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  gap: 15px;
  position: relative;
  transition: transform 0.2s;
}

.class-box:hover {
  transform: translateY(-3px);
}

.class-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 20px;
  font-weight: bold;
}

.class-header span[contenteditable="true"] {
  outline: none;
  border-bottom: 1px dashed transparent;
}

.class-header span[contenteditable="true"]:focus {
  border-bottom: 1px dashed black;
}

.menu {
  position: relative;
  cursor: pointer;
  font-size: 20px;
  user-select: none;
}

.menu-options {
  display: none;
  position: absolute;
  right: 0;
  top: 25px;
  background: white;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  z-index: 10;
  min-width: 180px;
}

.menu-options div {
  padding: 10px 15px;
  cursor: pointer;
  font-size: 14px;
  color: black;
}

.menu-options div:hover {
  background: #f2f2f2;
}

/* global disabled-option definition */
.disabled-option {
  color: #aaa !important;
  pointer-events: none;
}

.sample-label {
  font-size: 16px;
  color: #444;
}

.btn-row {
  display: flex;
  gap: 10px;
  justify-content: center;
}

/* ---------- Updated Modern Buttons ---------- */
.btn {
  flex: 1;
  padding: 10px 14px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
  color: white;
  background: linear-gradient(135deg, #1e90ff, #0056b3);
  transition: all 0.25s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.btn:hover {
  background: linear-gradient(135deg, #2d9cff, #0070e0);
  transform: translateY(-2px);
  box-shadow: 0 5px 14px rgba(0,0,0,0.4);
}

/* optional spacing fix for emoji icons */
.btn::first-letter {
  margin-right: 4px;
}

/* ---------- Hold & Record row ---------- */
.hold-record-row {
  display: none;
  gap: 10px;
  justify-content: center;
}

.video-preview-container {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 10px;
  align-items: flex-start;
}

.video-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

video {
  width: 300px;
  border-radius: 8px;
  display: none;
}

.close-video-btn {
  position: absolute;
  top: -6px;
  right: -6px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 12px;
  width: 20px;
  height: 20px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
  display: none;
}

/* FLEXBOX layout for captured images */
.samples-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  max-height: 220px;
  overflow-y: auto;
  padding: 4px;
  align-content: flex-start;
  justify-content: center;
}

.sample-item {
  position: relative;
  display: inline-block;
}

.sample-item img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 6px;
}

.remove-img-btn {
  position: absolute;
  top: -4px;
  right: -4px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 12px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
}

.add-class {
  border: 2px dashed #777;
  border-radius: 12px;
  width: 500px;
  height: 200px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #aaa;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s;
}

.add-class:hover {
  border-color: #2d2dff;
  color: #2d2dff;
}

/* ---------- Premium Lightbox Style ---------- */
#imgModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(12px);
  justify-content: center;
  align-items: center;
  transition: opacity 0.3s ease;
}

#imgModal img {
  max-width: 85%;
  max-height: 85%;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 0 60px rgba(0,0,0,0.9), 0 0 25px rgba(255,255,255,0.15);
  transition: transform 0.35s ease, box-shadow 0.35s ease;
}

#imgModal img:hover {
  transform: scale(1.02);
  box-shadow: 0 0 80px rgba(0,0,0,1), 0 0 40px rgba(255,255,255,0.2);
}

/* Navigation Arrows */
.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.9);
  font-size: 48px;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
  padding: 10px 16px;
  border-radius: 50%;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(5px);
  transition: all 0.25s ease;
}

.nav-btn:hover {
  background: rgba(255,255,255,0.2);
  color: white;
  transform: translateY(-50%) scale(1.1);
}

.prev-btn { left: 40px; }
.next-btn { right: 40px; }

/* Close Button */
.close-btn {
  position: absolute;
  top: 25px;
  right: 40px;
  color: white;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  text-shadow: 0 0 10px rgba(0,0,0,0.7);
  transition: transform 0.3s ease, color 0.3s ease;
}

.close-btn:hover {
  transform: scale(1.2);
  color: #ff4444;
}

/* ---------- Responsive adjustments ---------- */
@media (max-width: 768px) {
  .class-box, .add-class {
    width: 90%;
    flex: 1 1 90%;
  }
  .btn {
    font-size: 0.8rem;
    padding: 8px;
    min-width: 80px;
  }
  .sample-item img {
    width: 50px;
    height: 50px;
  }
  video {
    max-width: 250px;
  }
  .video-container {
    flex-direction: column;
    align-items: center;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.5rem;
    margin: 20px 0;
    text-align: center;
  }
  .btn {
    font-size: 0.75rem;
    padding: 6px;
  }
  .add-class {
    width: 90%;
    height: 150px;
    font-size: 0.9rem;
  }
  .video-container video {
    max-width: 200px;
  }
  .class-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }
  .menu {
    font-size: 18px;
  }
  .btn-row {
    flex-wrap: wrap;
    justify-content: center;
  }
}

/* Scrollable samples preview for mobile */
.samples-preview {
  overflow-x: auto;
  padding: 4px;
}

/* ---------- Updated Logo Style ---------- */
.logo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  margin: 0;
}

.logo {
  height: 200px; /* Bigger logo */
  width: auto;
}

@media (max-width: 480px) {
  .logo {
    height: 100px; /* mobile adjustment */
  }
}
</style>
</head>
<body>

<div class="logo-container">
  <img src="Images/Startup Park logo.png" 
       alt="Teachable Machine Logo" 
       class="logo">
</div>

<div class="class-container" id="classContainer">
  <!-- First Class Box Template -->
  <div class="class-box">
    <div class="class-header">
      <span contenteditable="true">Class 1</span>
      <div class="menu" onclick="toggleMenu(this)">‚ãÆ
        <div class="menu-options">
          <div onclick="deleteClass(this)">Delete class</div>
          <div onclick="removeSamples(this)" class="disabled-option">Remove All Samples</div>
          <div onclick="downloadSamples(this)" class="disabled-option">Download Samples</div>
        </div>
      </div>
    </div>

    <div class="sample-label">Add image Samples:</div>

    <div class="btn-row">
      <button class="btn webcam-btn">üì∑ Webcam</button>
      <button class="btn upload-btn">‚¨ÜÔ∏è Upload</button>
    </div>

    <div class="btn-row hold-record-row">
      <button class="btn hold-record-btn">‚è∫ Hold & Record</button>
    </div>

    <div class="video-preview-container">
      <div class="video-container">
        <video autoplay playsinline></video>
        <button class="close-video-btn">‚ùå</button>
      </div>
      <div class="samples-preview"></div>
    </div>
  </div>

  <!-- Add Class Button -->
  <div class="add-class" onclick="addClassBox()">+ Add a class</div>
</div>

<!-- Premium Image Lightbox Modal -->
<div id="imgModal">
  <span class="close-btn">&times;</span>
  <div class="nav-btn prev-btn">&#10094;</div>
  <div class="nav-btn next-btn">&#10095;</div>
  <img id="modalImg">
</div>

<!-- JS Dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* --------- Global JS Functions ---------- */
const classContainer = document.getElementById('classContainer');
const classTemplate = document.querySelector('.class-box').cloneNode(true);
let classCount = 1;

// Lightbox navigation
let currentImages = [];
let currentIndex = 0;

const imgModal = document.getElementById('imgModal');
const modalImg = document.getElementById('modalImg');
const prevBtn = document.querySelector('.prev-btn');
const nextBtn = document.querySelector('.next-btn');
const closeBtn = document.querySelector('.close-btn');

function openModal(images, index){
  currentImages = images;
  currentIndex = index;
  modalImg.src = currentImages[currentIndex].src;
  imgModal.style.display = 'flex';
}

function showPrev(){
  if(currentImages.length===0) return;
  currentIndex = (currentIndex -1 + currentImages.length) % currentImages.length;
  modalImg.src = currentImages[currentIndex].src;
}
function showNext(){
  if(currentImages.length===0) return;
  currentIndex = (currentIndex +1) % currentImages.length;
  modalImg.src = currentImages[currentIndex].src;
}

prevBtn.onclick = showPrev;
nextBtn.onclick = showNext;
closeBtn.onclick = ()=>{ imgModal.style.display='none'; };

window.addEventListener('keydown', (e)=>{
  if(imgModal.style.display==='flex'){
    if(e.key==='ArrowLeft') showPrev();
    if(e.key==='ArrowRight') showNext();
    if(e.key==='Escape') imgModal.style.display='none';
  }
});

/* --------- Existing Functions ---------- */
function toggleMenu(el) {
  const menu = el.querySelector('.menu-options');
  const isOpen = menu.style.display === "block";
  document.querySelectorAll('.menu-options').forEach(m => m.style.display = "none");
  menu.style.display = isOpen ? "none" : "block";
}

window.addEventListener("click", e => {
  if(!e.target.closest(".menu")) 
    document.querySelectorAll('.menu-options').forEach(m=>m.style.display="none");
});

function updateMenuOptions(box){
  if(!box) return;
  const preview = box.querySelector('.samples-preview');
  const hasImages = preview && preview.querySelectorAll('img').length > 0;
  const menuOptions = box.querySelectorAll('.menu-options div');
  menuOptions.forEach(opt => {
    const txt = (opt.textContent || "").trim();
    if(txt.includes("Remove All") || txt.includes("Download")){
      if(hasImages) opt.classList.remove('disabled-option');
      else opt.classList.add('disabled-option');
    }
  });
}

function deleteClass(el) {
  const classBox = el.closest('.class-box');
  const video = classBox.querySelector('video');
  if(video && video.srcObject) video.srcObject.getTracks().forEach(track=>track.stop());
  classBox.remove();
}

function removeSamples(el) { 
  const classBox = el.closest('.class-box');
  const preview = classBox.querySelector('.samples-preview');
  preview.innerHTML = "";
  updateMenuOptions(classBox);
  const menu = classBox.querySelector('.menu-options');
  if(menu) menu.style.display = 'none';
}

function downloadSamples(el) {
  const classBox = el.closest('.class-box');
  const className = classBox.querySelector('.class-header span').textContent.trim() || "class";
  const zip = new JSZip();
  classBox.querySelectorAll('.samples-preview img').forEach((img,i)=>{
    const data = img.src.split(',')[1];
    zip.file(`${className}_${i+1}.png`, data, {base64:true});
  });
  zip.generateAsync({type:"blob"}).then(content=>{
    const link = document.createElement('a');
    link.href = URL.createObjectURL(content);
    link.download = `${className}.zip`;
    link.click();
  });
}

function addClassBox(){
  classCount++;
  const classBox = classTemplate.cloneNode(true);
  classBox.querySelector('.class-header span').textContent = `Class ${classCount}`;
  classContainer.insertBefore(classBox, classContainer.lastElementChild);
  initWebcam(classBox);
  updateMenuOptions(classBox);
}

function initWebcam(classBox){
  const webcamBtn = classBox.querySelector('.webcam-btn');
  const video = classBox.querySelector('video');
  const preview = classBox.querySelector('.samples-preview');
  const holdRow = classBox.querySelector('.hold-record-row');
  const holdBtn = holdRow.querySelector('.hold-record-btn');
  const closeBtn = classBox.querySelector('.close-video-btn');
  const btnRow = classBox.querySelector('.btn-row');
  const uploadBtn = classBox.querySelector('.upload-btn');

  let stream = null;
  let interval = null;

  webcamBtn.addEventListener('click', async () => {
    try {
      if(!stream){
        stream = await navigator.mediaDevices.getUserMedia({video:true});
        video.srcObject = stream;
        video.style.display="block";
        closeBtn.style.display="flex";
      }
      holdRow.style.display="flex";
      if(video.parentNode && btnRow) video.parentNode.insertBefore(btnRow, video.nextSibling);
    } catch(err){
      console.error("Camera access denied or error:", err);
      alert("Unable to access camera. Check permissions.");
    }
  });

  // ----------------- Hold & Record Events -----------------
  holdBtn.addEventListener('mousedown', () => { interval = setInterval(()=>captureImage(),125); });
  holdBtn.addEventListener('mouseup',()=>clearInterval(interval));
  holdBtn.addEventListener('mouseleave',()=>clearInterval(interval));

  // Mobile touch support
  holdBtn.addEventListener('touchstart', e => { e.preventDefault(); interval = setInterval(()=>captureImage(),125); });
  holdBtn.addEventListener('touchend', e => { e.preventDefault(); clearInterval(interval); });
  holdBtn.addEventListener('touchcancel', e => { e.preventDefault(); clearInterval(interval); });

  closeBtn.addEventListener('click', ()=>{
    if(stream){
      stream.getTracks().forEach(track=>track.stop());
      stream = null;
    }
    video.style.display = "none";
    closeBtn.style.display = "none";
    holdRow.style.display = "none";
    if(classBox && btnRow && holdRow) classBox.insertBefore(btnRow, holdRow);
  });

  uploadBtn.addEventListener('click', ()=>{
    const input = document.createElement('input');
    input.type='file';
    input.accept='image/*';
    input.multiple=true;
    input.onchange = e => {
      Array.from(input.files).forEach(file=>{
        const reader = new FileReader();
        reader.onload = ev=> addImageToPreview(ev.target.result);
        reader.readAsDataURL(file);
      });
    };
    input.click();
  });

  function captureImage(){
    if(!video || video.readyState < 2) return;
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 640;
    canvas.height = video.videoHeight || 480;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    addImageToPreview(canvas.toDataURL("image/png"));
  }

  function addImageToPreview(src){
    const imgContainer = document.createElement('div');
    imgContainer.classList.add('sample-item');

    const img = document.createElement('img');
    img.src = src;
    img.addEventListener('click', ()=>{
      const allImgs = Array.from(preview.querySelectorAll('img'));
      const index = allImgs.indexOf(img);
      openModal(allImgs, index);
    });

    const removeBtn = document.createElement('button');
    removeBtn.classList.add('remove-img-btn');
    removeBtn.textContent='‚ùå';
    removeBtn.onclick = ()=>{
      imgContainer.remove();
      updateMenuOptions(classBox);
    };

    imgContainer.appendChild(img);
    imgContainer.appendChild(removeBtn);
    preview.appendChild(imgContainer);
    preview.scrollTop = preview.scrollHeight;

    updateMenuOptions(classBox);
  }

  updateMenuOptions(classBox);
}

document.querySelectorAll('.class-box').forEach(initWebcam);
</script>
</body>
</html>
